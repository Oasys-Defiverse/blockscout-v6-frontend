# 実装詳細

## システム構成

### コンポーネント
- Graph Node (v0.33.0)
  - イベント処理
  - データインデックス
  - GraphQLエンドポイント
- IPFS (v0.10.0)
  - サブグラフマニフェスト保存
  - 分散ストレージ
- PostgreSQL
  - エンティティデータ保存
  - インデックス管理

### アーキテクチャ
```
[Oasys Mainnet] <-> [Graph Node] <-> [PostgreSQL]
         ^              ^
         |              |
    [Contracts]     [IPFS]
```

## 実装仕様

### サブグラフ定義
- エンティティ
  - BridgeDeposit: デポジットイベントデータ
  - DailyBridgeStats: 日次統計データ
- イベント
  - ETHDepositInitiated: デポジット開始イベント
  - 対象コントラクト: TCGverseBridge, SaakuruBridge

### データ処理フロー
1. ブロック同期（2000ブロックずつ）
2. イベント検知と処理（70-100ms/イベント）
3. エンティティの保存
4. インデックス更新

### パフォーマンス最適化
- キャッシュ戦略
  - エンティティキャッシュ: 100%ヒット率
  - クエリキャッシュ: 85-90%ヒット率
- メモリ管理
  - OOMKiller対策
  - スワップ設定
- 処理速度
  - イベント処理: 70-100ms
  - クエリレスポンス: 70-200ms

## プラットフォーム対応

### M1/M2 Mac (arm64)
- Docker設定
  ```yaml
  platform: linux/amd64
  ```
- Rosetta 2互換性
- パフォーマンス考慮事項

### リソース要件
- メモリ使用量
  - Graph Node: 2-4GB
  - IPFS: 1GB
  - PostgreSQL: 1-2GB
- ストレージ
  - ブロックデータ
  - インデックス
  - バックアップ

## 監視と運用

### メトリクス
- ブロック同期状態
- イベント処理速度
- キャッシュヒット率
- メモリ使用量

### アラート
- OOMKiller検知
- 同期遅延
- エラー発生

### バックアップ
- PostgreSQLデータ
- IPFS保存データ
- 設定ファイル

最終更新: 2024年1月14日 