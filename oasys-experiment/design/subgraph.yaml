subgraph:
  name: tcgverse-bridge-stats
  description: |
    TCGverse BridgeのETHDepositInitiatedイベントを追跡し、
    bridgeされたOAS量を集計するサブグラフ

entities:
  BridgeDeposit:
    description: 個々のブリッジデポジットイベント
    fields:
      id: ID! # トランザクションハッシュ + ログインデックス
      from: Bytes! # 送信者アドレス
      to: Bytes! # 受信者アドレス
      amount: BigInt! # デポジット量（wei単位）
      timestamp: BigInt! # タイムスタンプ
      blockNumber: BigInt! # ブロック番号
      transactionHash: Bytes! # トランザクションハッシュ

  DailyBridgeStats:
    description: 日次のブリッジ統計
    fields:
      id: ID! # 日付（YYYY-MM-DD）
      date: String! # 日付（YYYY-MM-DD）
      totalAmount: BigInt! # その日の総デポジット量
      depositCount: Int! # その日のデポジット回数

contracts:
  TCGverseBridge:
    address: "0xa34a85ecb19c88d4965EcAfB10019E63050a1098"
    events:
      ETHDepositInitiated:
        description: OASデポジットイベント
        parameters:
          - name: from
            type: address
            indexed: true
          - name: to
            type: address
            indexed: true
          - name: amount
            type: uint256
            indexed: false
          - name: extraData
            type: bytes
            indexed: false

mappings:
  - event: ETHDepositInitiated
    handler: handleETHDepositInitiated
    entities:
      - BridgeDeposit
      - DailyBridgeStats
    processing:
      - イベントごとにBridgeDepositエンティティを作成
      - 日付ごとにDailyBridgeStatsを更新

queries:
  - name: 日次デポジット統計
    description: |
      日次のデポジット統計を取得
    example: |
      {
        dailyBridgeStats(
          orderBy: date,
          orderDirection: desc,
          first: 7
        ) {
          date
          totalAmount
          depositCount
        }
      }

  - name: 最新のデポジット履歴
    description: |
      最新のデポジットイベントを取得
    example: |
      {
        bridgeDeposits(
          first: 10,
          orderBy: timestamp,
          orderDirection: desc
        ) {
          from
          to
          amount
          timestamp
        }
      } 